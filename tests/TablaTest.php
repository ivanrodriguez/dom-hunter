<?php

require_once '../src/Ivansabik/DomHunter/clases/Presa.php';
require_once '../src/Ivansabik/DomHunter/clases/Tabla.php';

require '../vendor/autoload.php';

use Sunra\PhpSimple\HtmlDomParser;

# Prueba la clase Tabla

class TablaTest extends PHPUnit_Framework_TestCase {

    private $_dom;
    private static $_arrTablaPrueba = array(
        array('fecha' => '22/11/2013 09:09 AM', 'lugar_movimiento' => 'MEXICO D.F. En proceso de entrega MEX MEXICO D.F.', 'comentarios' => ''),
        array('fecha' => '21/11/2013 06:58 PM', 'lugar_movimiento' => 'MEXICO D.F. Movimiento en centro de distribución', 'comentarios' => 'Envío pendiente de salida a ruta local'),
        array('fecha' => '21/11/2013 06:56 PM', 'lugar_movimiento' => 'MEXICO D.F. Llegada a centro de distribución MEX MEXICO D.F.', 'comentarios' => '')
    );

    protected function setUp() {
        $strHtml = '<table width="100%" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><table width="100%" border="0" cellpadding="1" cellspacing="1"><tbody><tr><td width="16%" height="30" bgcolor="#d6d6d6" class="titulos"><div align="left" class="titulos">Número de guía</div></td><td width="30%" colspan="2" bgcolor="#edf0e9" class="respuestas"><div align="left" class="respuestas"> 6058622149464701741673</div></td><td width="16%" bgcolor="#d6d6d6" class="titulos"><div align="left" class="titulos">Código de rastreo</div></td><td width="35%" colspan="3" bgcolor="#edf0e9" class="respuestas"><div align="left" class="respuestas">0376912433</div></td></tr></tbody></table></td></tr><tr><td><table width="100%" border="0" cellpadding="1" cellspacing="1"><tbody><tr><td width="16%" bgcolor="#d6e3f5" class="titulos"><div align="left">Origen</div></td><td width="30%" bgcolor="#edf0e9" class="respuestas"><div align="left">MEXICO D.F.</div></td><td width="16%" bgcolor="#d6e3f5" class="titulos"><div align="left" class="titulos">Destino</div></td><td width="35%" colspan="3" class="respuestas"><table width="100%" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td height="30" width="50%" bgcolor="#edf0e9"><div align="left" class="respuestas">MEXICO D.F.</div></td><td height="30" width="30%" bgcolor="#d6e3f5" class="titulos">CP Destino</td><td height="30" width="20%" bgcolor="#edf0e9" class="respuestas" align="left">&nbsp;11000</td></tr></tbody></table></td></tr></tbody></table></td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" bgcolor="#d6d6d6" class="titulos"><div align="left">Estatus del servicio</div></td><td width="10%" bgcolor="#edf0e9" class="respuestasazul"><div align="left"><img src="images/palomita.png" border="0" width="50" height="50"></div></td><td width="20%" bgcolor="#edf0e9" class="respuestasazul"><div align="left">Entregado</div></td><td width="16%" height="20" bgcolor="#d6d6d6" class="titulos"><div align="left"><span class="titulos">Recibió</span></div></td><td width="25%" colspan="1" bgcolor="#edf0e9"><div class="respuestasazul2" align="left">SDR:MARTHA RODRIGUEZ </div></td><td width="10%" bgcolor="#edf0e9" class="style1"><div align="center"><img src="images/firma.png" onclick="darClick(\'6058622149464701741673FIR\')" style="cursor:pointer;" width="50" height="50"></div></td></tr></tbody></table></td></tr><tr><td align="center" bgcolor="edf0e9"><div class="msg_list"><p style="display: none;" id="6058622149464701741673FIR" class="style1 msg_head "></p><div class="msg_body"><table width="30%" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td height="3"></td></tr><tr><td width="14%" height="16" bgcolor="CC0000" class="style1"><div align="left"><span class="style5">Firma de Recibido</span></div></td></tr><tr><td><img src="/RastreoWebInternet/firmaServlet?guia=6058622149464701741673&amp;idioma=es" width="224" height="120"></td></tr><tr><td height="3"></td></tr></tbody></table></div></div></td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" height="30" bgcolor="#d6e3f5" class="titulos"><div align="left" class="titulos">Servicio</div></td><td width="30%" colspan="2" bgcolor="#edf0e9" class="respuestas"><div align="left" class="respuestas">Entrega garantizada al segundo día hábil</div></td><td width="16%" height="30" bgcolor="#d6e3f5" class="titulos"><div align="left" class="titulos">Fecha y hora de entrega</div></td><td width="35%" colspan="3" bgcolor="#edf0e9" class="style1"><div align="left" class="respuestas">22/11/2013 10:43 AM</div></td></tr></tbody></table></td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" height="30" bgcolor="#d6d6d6" class="titulos"><div align="left"><span class="titulos">Tipo de envío</span></div></td><td width="30%" colspan="2" bgcolor="#edf0e9" class="respuestas"><div align="left"><span class="respuestas">PAQUETE</span></div></td><td width="16%" bgcolor="#d6d6d6" height="30" class="titulos"><div align="left" class="titulos">Fecha programada <br>de entrega</div></td><td width="35%" colspan="3" bgcolor="#edf0e9" class="respuestas"><div align="left" class="respuestas">25/11/2013<br></div></td></tr></tbody></table></td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" height="30" bgcolor="#d6e3f5" class="titulos"><div align="left"><span class="titulos">Número de orden de recolección</span></div></td><td width="30%" colspan="2" bgcolor="#edf0e9" class="respuestas"><div align="left"><span class="respuestas"><a href="http://rastreo2.estafeta.com/ShipmentPickUpWeb/actions/pickUpOrder.do?method=doGetPickUpOrder&amp;forward=toPickUpInfo&amp;idioma=es&amp;pickUpId=8058829" class="cuerpo" target="_blank">8058829</a></span></div></td><td width="16%" height="40" bgcolor="#d6e3f5" class="titulos"><div align="left" class="titulos">Fecha de recolección</div></td><td width="35%" colspan="3" bgcolor="#edf0e9" class="respuestas"><div align="left" class="respuestas"> 21/11/2013 05:32 PM</div></td></tr></tbody></table></td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" height="30" bgcolor="#d6d6d6" class="titulos"><div align="left"><span class="titulos">Orden de rastreo*</span></div></td><td width="81%" colspan="6" height="30" bgcolor="#edf0e9" class="respuestas"><div align="left"><span class="respuestas">Haga<a href="http://rastreo2.estafeta.com/OrdenRastreo/solic_rastreoCP_esp.jsp?guia=6058622149464701741673&amp;entregado=1&amp;engarantia=0" class="cuerpo" target="_blank"> clic aquí</a> para levantar una orden de rastreo.</span></div></td></tr></tbody></table></td></tr><tr><td><table width="690" align="center" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td class="pies"><div align="left"><span class="pies">*Aclaraciones acerca de su envío</span></div></td></tr></tbody></table></td></tr><tr><td>&nbsp;</td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="33%" rowspan="2" bgcolor="#d6d6d6" class="titulos"><div align="center"><span class="titulos">Guías envíos múltiples</span></div></td><td width="33%" bgcolor="#d6e3f5" class="titulos"><div align="center"><span class="titulos">Guía documento de retorno</span></div></td><td width="33%" bgcolor="#d6d6d6" class="titulos"><div align="center"><span class="titulos">Guía internacional</span></div></td></tr></tbody></table><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="33%" bgcolor="#edf0e9" class="style1"><div align="center">&nbsp;</div></td><td width="33%" bgcolor="#edf0e9" class="style1"><div align="center">&nbsp;</div></td><td width="33%" bgcolor="#edf0e9" class="repuestas"><div align="center">&nbsp;</div></td></tr></tbody></table></td></tr><tr><td>&nbsp;</td></tr><tr><td><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="20%" rowspan="3" bgcolor="#d6e3f5" class="titulos"><div align="center"><span class="titulos">Características del envío</span><br><img onclick="darClick(\'6058622149464701741673CAR\')" src="images/caracter_envio.png" style="cursor:pointer;" border="0" width="75" height="75"></div></td><td width="20%" rowspan="3" bgcolor="#d6e3f5" class="titulos"><div align="center"><span class="titulos">Historia</span><br><img onclick="darClick(\'6058622149464701741673HIS\')" src="images/historia.png" style="cursor:pointer;" border="0" width="75" height="75"></div></td><td width="20%" rowspan="3" bgcolor="#d6e3f5" class="titulos"><div align="center"><span class="titulos">Preguntas frecuentes</span><br><a target="_blank" href="http://www.estafeta.com/herramientas/ayuda.aspx"><img src="images/preguntas.png" border="0" width="75" height="75"></a></div></td><td width="20%" rowspan="3" bgcolor="#d6e3f5" class="titulos"><div align="center"><span class="titulos">Comprobante de entrega</span><br><a target="_blank" href="/RastreoWebInternet/consultaEnvio.do?dispatch=doComprobanteEntrega&amp;guiaEst=6058622149464701741673"><img src="images/comprobante.png" border="0" width="75" height="75"></a></div></td></tr></tbody></table></td></tr><tr><td><div class="msg_list"><p style="display: none;" id="6058622149464701741673CAR" class="style1 msg_head "></p><div class="msg_body"><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="20%" rowspan="3" bgcolor="#d6d6d6" class="style1"><div align="center"><span class="titulos">Características </span></div></td></tr></tbody></table><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="16%" height="20" bgcolor="#d6e3f5" class="titulos"><div align="left"><span class="titulos">Tipo de envío</span></div></td><td width="30%" bgcolor="#edf0e9" class="respuestas"><div align="left"><span class="respuestas">PAQUETE</span></div></td><td width="20%" bgcolor="#d6e3f5" class="style1"><div align="left"><span class="titulos">Dimensiones cm</span></div></td><td width="30%" bgcolor="#edf0e9" class="style1"><div align="left"><span class="respuestas">0x0x0</span></div></td></tr><tr><td width="20%" bgcolor="#d6d6d6" class="style1"><div align="left"><span class="titulos">Peso kg</span></div></td><td width="30%" bgcolor="#edf0e9" class="style1"><div align="left"><span class="respuestas">0.1</span></div></td><td width="20%" bgcolor="#d6d6d6" class="style1"><div align="left"><span class="titulos">Peso volumétrico kg</span></div></td><td width="30%" bgcolor="#edf0e9" class="style1"><div align="left"><span class="respuestas">0.0</span></div></td></tr><tr><td width="20%" bgcolor="#d6e3f5" class="style1"><div align="left"><span class="titulos">Referencia cliente</span></div></td><td colspan="3" width="80%" bgcolor="#edf0e9" class="style1"><div align="center">&nbsp;</div></td></tr></tbody></table></div></div></td></tr><tr><td><div class="msg_list"><p style="display: none;" id="6058622149464701741673HIS" class="style1 msg_head "></p><div class="msg_body"><table width="100%" border="0" cellpadding="2" cellspacing="1"><tbody><tr><td width="20%" rowspan="3" bgcolor="#d6d6d6" class="style1"><div align="center"><span class="titulos">Historia </span></div></td></tr></tbody></table><table width="100%" border="0" cellpadding="0" cellspacing="1"><tbody><tr><td width="22%" height="23" bgcolor="#d6d6d6" class="titulos"><div align="center">Fecha - Hora</div></td><td width="31%" height="23" bgcolor="#d6d6d6" class="titulos"><div align="center">Lugar - Movimiento</div></td><td width="20%" height="23" bgcolor="#d6d6d6" class="titulos"><div align="center">Comentarios</div></td></tr><tr><td bgcolor="#e3e3e3" class="style1"><div class="respuestasNormal" align="left">22/11/2013 09:09 AM</div></td><td bgcolor="#e3e3e3" class="respuestasNormal"><div align="left"> MEXICO D.F. En proceso de entrega MEX MEXICO D.F.</div></td><td bgcolor="#e3e3e3" class="style1"><div align="left" class="respuestasNormal">&nbsp;</div></td></tr><tr><td bgcolor="#d6e3f5" class="style1"><div class="respuestasNormal" align="left">21/11/2013 06:58 PM</div></td><td bgcolor="#d6e3f5" class="respuestasNormal"><div align="left"> MEXICO D.F. Movimiento en centro de distribución</div></td><td bgcolor="#d6e3f5" class="style1"><div align="left" class="respuestasNormal">Envío pendiente de salida a ruta local </div></td></tr><tr><td bgcolor="#e3e3e3" class="style1"><div class="respuestasNormal" align="left">21/11/2013 06:56 PM</div></td><td bgcolor="#e3e3e3" class="respuestasNormal"><div align="left"> MEXICO D.F. Llegada a centro de distribución MEX MEXICO D.F.</div></td><td bgcolor="#e3e3e3" class="style1"><div align="left" class="respuestasNormal">&nbsp;</div></td></tr></tbody></table></div></div></td></tr></tbody></table>';
        $this->_dom = HtmlDomParser::str_get_html($strHtml);
    }

    public function testNavegacion() {
        $opcionesQuery = array('getElementById' => '6058622149464701741673HIS', 'nextSibling' => '', 'lastChild' => '');
        $opcionesTabla = array('navegacion' => $opcionesQuery);
        $columnas = array('fecha', 'lugar_movimiento', 'comentarios');
        $tabla = new Tabla($opcionesTabla, $columnas);
        $this->assertEquals(self::$_arrTablaPrueba, $tabla->duckTest($this->_dom));
    }

    public function testOcurrenciaNumero() {
        $opcionesTabla = array('ocurrencia' => 18);
        $columnas = array('fecha', 'lugar_movimiento', 'comentarios');
        $tabla = new Tabla($opcionesTabla, $columnas);
        $this->assertEquals(self::$_arrTablaPrueba, $tabla->duckTest($this->_dom));
    }

    public function testOcurrenciaUltimo() {
        $opcionesTabla = array('ocurrencia' => -1);
        $columnas = array('fecha', 'lugar_movimiento', 'comentarios');
        $tabla = new Tabla($opcionesTabla, $columnas);
        $this->assertEquals(self::$_arrTablaPrueba, $tabla->duckTest($this->_dom));
    }

    public function testNumOcurrenciaInvalido() {
        $this->markTestIncomplete('testNumOcurrenciaInvalido() no esta definido');
    }

    public function testResultadoQueryNoTable() {
        $this->markTestIncomplete('testResultadoQueryNoTable() no esta definido');
    }

    public function testSkipTitulos() {
        $this->markTestIncomplete('testSkipTitulos() no esta definido');
    }

}
